name: Build and Test libc++
on:
  push:
  #schedule:
  #  # Run nightly at 08:00 UTC (aka 00:00 Pacific, aka 03:00 Eastern)
  #  - cron: '0 8 * * *'

permissions:
  contents: read # Default everything to read-only

env:
  WORKSPACE_PATH: ${{ github.workspace }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Maximize build space
        run: |
          echo "Available storage before:"
          sudo df -h
          echo
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /usr/local/lib/android
          sudo rm -rf /opt/ghc
          sudo rm -rf /opt/hostedtoolcache/CodeQL
          echo "Available storage after:"
          sudo df -h
          echo
      - uses: actions/checkout@v4
      - name: install dependencies
        run: sudo ./docker/setup-deps.sh
      - name: build LLVM
        run: ./docker/setup-llvm.sh
      - name: build LLVM-MCA-Daemon
        run: ./docker/setup-build.sh
  

# Maximize build space action above used from https://github.com/drivendataorg/zamba/pull/336/files,
# used here under license:
# 
#   > MIT License
# 
#   > Copyright (c) 2022 DrivenData Inc.
# 
#   > Permission is hereby granted, free of charge, to any person obtaining a copy
#   > of this software and associated documentation files (the "Software"), to deal
#   > in the Software without restriction, including without limitation the rights
#   > to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
#   > copies of the Software, and to permit persons to whom the Software is
#   > furnished to do so, subject to the following conditions:
# 
#   > The above copyright notice and this permission notice shall be included in all
#   > copies or substantial portions of the Software.
# 
#   > THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#   > IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#   > FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
#   > AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
#   > LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
#   > OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
#   > SOFTWARE.